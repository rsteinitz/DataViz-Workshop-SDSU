---
title: "Making Data Speak: Principles and Practice of Scientific Visualization"
subtitle: "Part 1: Code-Along"
author: "Ronnie Bailey-Steinitz"
date: "2026-02-06"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Session goals (10:00â€“12:00)

In this morning code-along, we will:  
- Warm up with a familiar numeric dataset (Palmer Penguins): build a scatterplot step-by-step.
- Practice smoothing, faceting, and annotation choices.
- Transition to a categorical-heavy, field-style dataset (primate road-crossing data).
- Build a publication-style figure using aggregation + thoughtful design.  
  
Some useful keyboard shortcuts: 
- New code chunk:  Ctrl+Alt+i // Cmd+Option+i
- Comment or uncomment: Ctrl+Shift+C // Cmd+Shift+C
- Run current selected code line: Ctrl+Enter // Cmd+Return
- Select Word: Ctrl+Shift+Left/Right //	Option+Shift+Left/Right
- Select to Line Start: Alt+Shift+Left // Cmd+Shift+Left
- Select to Line End: Alt+Shift+Right // Cmd+Shift+Right  

## Attach Packages
```{r}

# Core
library(ggplot2)
library(here)

# Data import + wrangling
library(readr)
library(dplyr)
library(tidyr)
library(stringr)
library(lubridate)
library(forcats)
library(janitor)

# Plot helpers
library(scales)
library(patchwork)

```

## 0. Read in Data
```{r}

#data <- readr::read_csv("path/to/primate_road_crossings.csv")
penguins <- read_csv(here("SDSU Data Viz 2026/Palmer Penguins Raw.csv")) %>% 
  janitor::clean_names() %>% 
  mutate(spp = case_when(species == "Adelie Penguin (Pygoscelis adeliae)" ~ "Adelie",
                         species == "Gentoo penguin (Pygoscelis papua)" ~ "Gentoo",
                        species == "Chinstrap penguin (Pygoscelis antarctica)" ~ "Chinstrap"))

```

## 1. Look at data
### 1.1 summary stats
```{r}

penguins <- penguins %>%
  dplyr::filter(
    !is.na(bill_length_mm),
    !is.na(bill_depth_mm),
    !is.na(species),
    !is.na(sex)
  ) %>% 
  mutate(date_e = lubridate::mdy(date_egg))

dplyr::glimpse(penguins)

# Every ggplot has 3 components: data, aes (aka mapping), geom:
ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram()

ggplot(penguins, aes(x = bill_length_mm)) +
  geom_histogram()

```

## 2. Plotting
### 2.1 Scatterplot
```{r}

# BASE
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point()

# Add color
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point()

# Move legend
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point() +
  theme(legend.position = "bottom")

# Improve readability - alpha & labels & theme!
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point(alpha = 0.5) +
  labs(
    title = "Bill size varies by species",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) 

# Custom colors
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point(alpha = 0.5) +
  labs(
    title = "Bill size varies by species",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen"))

```

> You can find all the keys and hex codes to innate R colors here: https://r-charts.com/colors/  
> ...and more on how to use colors in ggplots here: https://r-graph-gallery.com/ggplot2-color.html  

### 2.2 Adding themes
Themes are pre-defined sets of parameters that give ggplots specific types of appearances
```{r}

ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point(alpha = 0.5) +
  labs(
    title = "Bill size varies by species",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()
  # theme_light()
  # theme_dark()
  # theme_minimal()
  # theme_classic() # classic data plot ready for publication
  # theme_void() #excludes anything but the geom itself
  



```

> More on themes here: https://ggplot2.tidyverse.org/reference/ggtheme.html

### 2.3 Add trendlines
```{r}

# smooth (curved) lines
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point(alpha = 0.7) +
  geom_smooth(se = FALSE) +
  labs(
    title = "Scatterplot + smoothing",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()

# make it linear!
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE) +
  labs(
    title = "Scatterplot + smoothing",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()

# Modify the lines
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  labs(
    title = "Scatterplot + smoothing",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()

```

Other linetype options are: twodash; solid; longdash; dotted; dotdash; dashed.

### 2.4 Shapes
```{r}

ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp, shape = spp)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  labs(
    title = "Scatterplot + smoothing",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()


# combine the legends
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp, shape = spp)) +
  geom_point(alpha = 0.7) +
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  labs(
    title = "Scatterplot + smoothing",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species",
    shape = "Species" # <----- note that we tell ggplot that the legend for the shape has the same name as that for the color, so it auto-combines them
  ) + 
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()

# ...or...
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp, shape = spp)) +
  geom_point(alpha = 0.7, show.legend = FALSE) + # < ---- just tell geom_point NOT to plot legend at all
  geom_smooth(method = "lm", se = FALSE, linetype = "dashed") +
  labs(
    title = "Scatterplot + smoothing",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
    # no "shape" in labels section
  ) + 
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()

#  Now ggplot knows color and shape belong to the same variable. It automatically merges them into a single legend.


# Stack layers with statistics:
ggplot(penguins, aes(x = bill_length_mm, y = bill_depth_mm, color = spp, shape = spp)) +
  geom_point(alpha = 0.7) + 
  stat_ellipse() +
  # stat_ellipse(level = 0.2) +
  labs(
    title = "Scatterplot + Ellipses",
    x = "Bill length (mm)",
    y = "Bill depth (mm)",
    color = "Species"
  ) + 
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  theme_bw()

# stat_ellipse() is a statistical, visual tool that defines a region containing a specified percentage of data points (assuming a normal distribution). It represents the data's mean, standard deviation, and correlation, serving as a boundary for identifying outliers and understanding linear relationships. 

# The default "cutoff" for 'stat_ellipse()' in the ggplot2 package is a confidence level of 0.95 (95%). This is controlled by the 'level' argument


```

Next, we'll look at how to manage your viewer's attention, and in the process, we'll see new types of charts.

## 3. Storytelling: Managing the viewer's attention
### 3.1 Using colors
```{r}

penguins %>% dplyr::count(clutch_completion, spp)

# basic stacked bar chart
ggplot(penguins, aes(x = spp, fill = clutch_completion)) +
  geom_bar() +
  #scale_fill_manual(values = c("green4", "firebrick3")) + # but notice the colors, what are they telling you???
  # scale_fill_manual(values = c("firebrick", "green4")) + # this makes more sense-- play on peoples' familiarity with color-coding!!! 
  labs(x = "Species", y = "N") +
  theme_bw() 

# you can change the focus of the chart
ggplot(penguins, aes(x = clutch_completion, fill = spp)) +
  geom_bar() +
  #scale_fill_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  labs(x = "Clutch Completion", y = "N") +
  theme_bw() 

# we simply switched which variable was on the x-axis, and while is the color fill, but it makes a difference in how you tell the story!


# or highlight one particular aspect using colors
ggplot(penguins, aes(x = clutch_completion, fill = spp)) +
  geom_bar() +
  scale_fill_manual(values = c("purple4", "grey80", "grey90")) +
  labs(x = "Clutch Completion", y = "N") +
  theme_bw() 

# hmmm... I don't like the vertical lines in the background, so let's get rid of those:
ggplot(penguins, aes(x = clutch_completion, fill = spp)) +
  geom_bar() +
  scale_fill_manual(values = c("purple4", "grey80", "grey90")) +
  labs(x = "Clutch Completion", y = "N") +
  theme_bw() +
  theme(panel.grid.major.x = element_blank()) # this allows us to change certain aspects of the visual formatting fo the chart
 # --> also try: panel.grid.major.y / panel.grid.minor.y

# you can also go back to you summary stats:
ggplot(penguins, aes(x = bill_length_mm, fill = spp)) +
  geom_histogram() +
  scale_fill_manual(values = c("purple4", "grey80", "grey80")) +
  theme_bw()

```

### 3.2 Using visual cues
```{r}

ggplot(penguins, aes(x = date_e, y = bill_length_mm)) +
  geom_point()

# hmm... looks like there was one season each year from 2007-2009...
# so, does it make sense to plot the x-axis as full dates? with months and days?
# waste of space.
# instead, we can focus on what we want to look ate-- egg-laying season, which seems to be days within the month of October in these years
ggplot(penguins, aes(x = lubridate::day(date_e), y = bill_length_mm)) +
  geom_point()

# good, but not there yet...

# let's try to see what's happening by species:
# add 'color = spp' to aes() in ggplot
ggplot(penguins, aes(x = lubridate::day(date_e), y = bill_length_mm, color = spp)) +
  geom_point(alpha = 0.7) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  labs(x = "Date, Month of October", y = "Bill Length (mm)") +
  theme_bw() 

# let's say something happened on a particular date that you want to highlight:
# for example, if a few days had rain:
ggplot(penguins, aes(x = lubridate::day(date_e), y = bill_length_mm, color = spp)) +
  geom_point(alpha = 0.7) +
  scale_color_manual(values = c("purple4", "orchid3", "lightseagreen")) +
  annotate("rect", 
           xmin = 20, # from the 20th
           xmax = 22, # to the 22nd
           ymin = Inf, # set ymin to +infinity
           ymax = -Inf, # set ymax to -infinity 
           fill = "red", 
           # fill = "skyblue",   # maybe use a color that makes sense for rain instead of red
           alpha = 0.3) +
  labs(x = "Date, Month of October", y = "Bill Length (mm)") +
  theme_bw() 

```



- Accessible colors! color blindness
- adding v- or h-lines
- facet_grid(var1 ~ var2) (or just ~var1)
